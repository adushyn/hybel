@if (properties.length > 0) {
  <div class="table-container">
    <table mat-table [dataSource]="properties" class="portfolio-table">
      <!-- Attention Column -->
      <ng-container matColumnDef="attention">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let property">
          @if (property.needsAttention) {
            <mat-icon
              class="attention-icon"
              [matTooltip]="getAttentionTooltip(property)"
              matTooltipPosition="right">
              warning
            </mat-icon>
          }
        </td>
      </ng-container>

      <!-- Address Column -->
      <ng-container matColumnDef="address">
        <th mat-header-cell *matHeaderCellDef>Address</th>
        <td mat-cell *matCellDef="let property">
          <div class="address-cell">
            <strong>{{ property.address }}</strong>
            <span class="city">{{ property.city }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Type Column -->
      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef>Type</th>
        <td mat-cell *matCellDef="let property">
          <mat-chip>{{ property.type | titlecase }}</mat-chip>
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let property">
          <mat-chip [class]="'status-' + property.status">
            {{ property.status | titlecase }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Tenant Column -->
      <ng-container matColumnDef="tenant">
        <th mat-header-cell *matHeaderCellDef>Tenant</th>
        <td mat-cell *matCellDef="let property">
          @if (property.tenant) {
            <span>{{ property.tenant.name }}</span>
          } @else {
            <span class="no-tenant">—</span>
          }
        </td>
      </ng-container>

      <!-- Rent Column -->
      <ng-container matColumnDef="rent">
        <th mat-header-cell *matHeaderCellDef>Rent</th>
        <td mat-cell *matCellDef="let property">
          <span class="rent-amount">{{ property.monthlyRent | number:'1.0-0' }} NOK</span>
        </td>
      </ng-container>

      <!-- Lease Expires Column -->
      <ng-container matColumnDef="leaseExpires">
        <th mat-header-cell *matHeaderCellDef>Lease Expires</th>
        <td mat-cell *matCellDef="let property">
          @if (property.leaseExpires) {
            <div class="lease-cell">
              <span>{{ property.leaseExpires | date: 'dd.MM.yyyy' }}</span>
              @if (property.daysUntilLeaseExpiry !== null && property.daysUntilLeaseExpiry <= 60) {
                <span class="expiring-soon">({{ property.daysUntilLeaseExpiry }} days)</span>
              }
            </div>
          } @else {
            <span class="no-lease">—</span>
          }
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let property">
          <button
            mat-icon-button
            (click)="onViewDetails(property.id)"
            matTooltip="View Details">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row
          *matRowDef="let row; columns: displayedColumns;"
          [class.attention-row]="row.needsAttention"></tr>
    </table>
  </div>
} @else {
  <div class="empty-state">
    <mat-icon>inbox</mat-icon>
    <h3>No properties found</h3>
    <p>Try adjusting your filters to see more results.</p>
  </div>
}
